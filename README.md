# Веб-сервис "Анкета пользователя"

Учебный веб-сервис на PHP 8+ и MySQL 8 для обработки анкет пользователей с использованием безопасных практик программирования.

## Технологии

- **PHP 8+** (без фреймворков)
- **MySQL 8** (или совместимая)
- **mysqli** с подготовленными выражениями (Prepared Statements)
- **HTML5 + Bootstrap 5** (CDN)
- **Серверная валидация** всех входных данных

## Структура проекта

```
project/
├── form.html              # HTML форма ввода данных
├── process.php            # Обработчик формы с валидацией и сохранением
├── config.php             # Конфигурация подключения к БД (не в git)
├── config.example.php     # Шаблон конфигурации
├── db/
│   └── init.sql          # SQL скрипт инициализации БД
├── assets/
│   └── styles.css        # Дополнительные стили
└── README.md             # Документация проекта
```

## Установка и запуск

### Шаг 1: Создание базы данных

1. Откройте MySQL клиент (phpMyAdmin, MySQL Workbench, или командная строка)
2. Выполните SQL скрипт из файла `db/init.sql`:
   ```sql
   mysql -u root -p < db/init.sql
   ```
   Или скопируйте содержимое `db/init.sql` и выполните в вашем MySQL клиенте.

   Скрипт создаст:
   - Базу данных `user_form_db_bychkovskaya`
   - Таблицу `user_profiles` с необходимыми полями

### Шаг 2: Настройка конфигурации

1. Скопируйте файл `config.example.php` в `config.php`:
   ```bash
   cp config.example.php config.php
   ```

2. Откройте `config.php` и заполните параметры подключения:
   ```php
   define('DB_HOST', 'localhost');      // Хост БД
   define('DB_NAME', 'user_form_db_bychkovskaya');
   define('DB_USER', 'root');            // Ваш пользователь MySQL
   define('DB_PASS', '');                // Ваш пароль MySQL
   ```

### Шаг 3: Запуск веб-сервера

#### Вариант 1: Встроенный PHP сервер (для разработки)

```bash
php -S localhost:8000
```

Затем откройте в браузере: `http://localhost:8000/form.html`

#### Вариант 2: Apache/Nginx

Настройте виртуальный хост, указывающий на корневую директорию проекта.

### Шаг 4: Проверка работы

1. Откройте форму `form.html` в браузере
2. Заполните все поля:
   - **Полное имя**: 2-100 символов, только буквы, пробелы, дефисы, апострофы
   - **Email**: корректный email адрес
   - **Телефон**: 7-20 символов (цифры, +, пробелы, дефисы, скобки)
   - **Возраст**: число от 0 до 120
3. Отправьте форму
4. При успешном сохранении вы увидите зелёную карточку с сохранёнными данными
5. При ошибках валидации - красную карточку со списком ошибок

## Безопасность

Проект реализует следующие меры безопасности:

### 1. Prepared Statements (Подготовленные выражения)

Все SQL запросы выполняются через подготовленные выражения `mysqli`, что предотвращает SQL-инъекции:

```php
$stmt = $mysqli->prepare("INSERT INTO user_profiles (full_name, email, phone, age) VALUES (?, ?, ?, ?)");
$stmt->bind_param("sssi", $fullName, $email, $phone, $age);
$stmt->execute();
```

### 2. Экранирование вывода (XSS защита)

Все данные, выводимые в HTML, экранируются через `htmlspecialchars()`:

```php
echo htmlspecialchars($value, ENT_QUOTES, 'UTF-8');
```

### 3. Серверная валидация

- Клиентская валидация (HTML5 атрибуты) - только для удобства пользователя
- **Серверная валидация обязательна** и является основной защитой
- Все данные проверяются на:
  - Тип и формат
  - Длину
  - Разрешённые символы
  - Диапазон значений

### 4. Обработка ошибок

- Ошибки БД обрабатываются через try-catch
- Пользователю показываются дружелюбные сообщения без утечки конфиденциальных данных (DSN, пароли)
- Включён строгий режим отчёта об ошибках mysqli для разработки

### 5. Защита конфигурации

- `config.php` содержит конфиденциальные данные и должен быть добавлен в `.gitignore`
- `config.example.php` - шаблон без реальных данных для версионирования

## Валидация полей

### Полное имя (full_name)
- Обязательное поле
- Длина: 2-100 символов
- Разрешённые символы: буквы (латиница, кириллица), пробелы, дефисы, апострофы

### Email
- Обязательное поле
- Максимальная длина: 255 символов
- Проверка через `filter_var($email, FILTER_VALIDATE_EMAIL)`

### Телефон (phone)
- Обязательное поле
- Длина: 7-20 символов
- Разрешённые символы: цифры, `+`, пробелы, дефисы, скобки

### Возраст (age)
- Обязательное поле
- Тип: целое число
- Диапазон: 0-120

## Структура базы данных

### Таблица: `user_profiles`

| Поле | Тип | Описание |
|------|-----|----------|
| `id` | INT AUTO_INCREMENT PRIMARY KEY | Уникальный идентификатор |
| `full_name` | VARCHAR(255) NOT NULL | Полное имя пользователя |
| `email` | VARCHAR(255) NOT NULL | Email адрес |
| `phone` | VARCHAR(32) NOT NULL | Номер телефона |
| `age` | INT NOT NULL | Возраст |
| `created_at` | TIMESTAMP DEFAULT CURRENT_TIMESTAMP | Дата создания записи |

## Требования

- PHP 8.0 или выше
- MySQL 8.0 или выше (или совместимая СУБД)
- Расширение PHP `mysqli`
- Веб-сервер (Apache, Nginx) или встроенный PHP сервер для разработки

## Лицензия

Учебный проект для образовательных целей.

